name: mac-build
on:
  push:
    branches: [ "7.4.x-4.8.x-grpc" ]

jobs:
    build:
        runs-on: macos-latest
        steps:
          - uses: actions/checkout@v2
          - name: init deps
            run: |
              mkdir -p pool/lib pool/ext
              mkdir -p ../opt
              ./prepare.php macos /Users/runner/work/swoole-cli
              brew uninstall --ignore-dependencies oniguruma
              brew uninstall --ignore-dependencies brotli
              brew uninstall --ignore-dependencies freetype
              ln -s /usr/local/bin/glibtoolize /usr/local/bin/libtoolize
              brew install cmake autoconf
          - name: make configure
            run: |
               ./make.sh config
          - name: make build
            run: |
              ./make.sh build
              otool -L ./bin/swoole-cli

